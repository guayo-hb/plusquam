<!DOCTYPE html>
<html lang="de" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pronomen: Demonstrativ-, Indefinit- und Possessivpronomen</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body { font-family: ui-sans-serif, system-ui, sans-serif; background: #f8fafc; color: #1e293b; margin: 0; padding: 0; -webkit-font-smoothing: antialiased; height: 100%; overflow: hidden; }
        #app-root { display: flex; flex-direction: column; height: 100%; width: 100%; max-width: 600px; margin: 0 auto; background: white; position: relative; border-left: 1px solid #e2e8f0; border-right: 1px solid #e2e8f0; }
        #scroll-container { flex: 1; overflow-y: auto; padding: 1.5rem; scroll-behavior: smooth; }
        
        .exercise-input, .exercise-select { border-radius: 0.6rem; padding: 0.3rem 0.8rem; border: 2px solid #e2e8f0; outline: none; margin: 0 0.25rem; display: inline-block; min-width: 100px; width: auto; transition: all 0.2s; background: #fdfdfd; font-weight: 700; color: #0f172a; font-size: 1rem; -webkit-appearance: none; vertical-align: middle; }
        .exercise-select { padding-right: 2rem; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236366f1' stroke-width='3'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M19 9l-7 7-7-7' /%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 0.7rem center; background-size: 1rem; }
        
        .exercise-input:focus, .exercise-select:focus { border-color: #6366f1; background-color: white; box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1); }
        .correct { border-color: #10b981 !important; background-color: #ecfdf5 !important; }
        .incorrect { border-color: #ef4444 !important; background-color: #fef2f2 !important; }
        
        .word-option { display: inline-block; cursor: pointer; padding: 0.6rem 1rem; margin: 0.25rem; border-radius: 0.8rem; background-color: #f1f5f9; border: 2px solid #e2e8f0; transition: all 0.2s; font-weight: 700; color: #334155; }
        .word-option.selected { background-color: #e0e7ff; color: #4338ca; border-color: #6366f1; }
        
        .tip-btn { display: inline-flex; align-items: center; justify-content: center; width: 24px; height: 24px; background: #fef3c7; color: #d97706; border-radius: 8px; border: 1px solid #fde68a; cursor: pointer; margin-left: 6px; font-size: 14px; vertical-align: middle; transition: all 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .tip-btn:hover { background: #fde68a; transform: scale(1.1) rotate(5deg); }
        .tip-content { display: none; background: #fffbeb; border: 1px solid #fde68a; color: #92400e; padding: 8px 12px; border-radius: 10px; font-size: 11px; margin-top: 6px; font-weight: 600; line-height: 1.5; animation: popIn 0.3s; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
        .tip-content.visible { display: block; }

        .solution-hint { display: inline-block; padding: 0.2rem 0.6rem; font-size: 0.7rem; font-weight: 800; background: #6366f1; color: white; border-radius: 0.5rem; margin-left: 0.4rem; animation: bounceIn 0.3s; vertical-align: middle; }
        
        #nav-bar { flex-shrink: 0; background: white; border-top: 1px solid #e2e8f0; padding: 1.25rem; display: flex; gap: 1rem; box-shadow: 0 -4px 6px -1px rgba(0,0,0,0.05); }
        .check-btn { width: 100%; padding: 1rem; background: #1e293b; color: white; border-radius: 1rem; font-weight: 900; text-transform: uppercase; cursor: pointer; border: none; transition: all 0.2s; margin-top: 1.5rem; }
        .nav-btn-next { flex: 2; padding: 0.8rem; background: #6366f1; color: white; border-radius: 0.8rem; font-weight: 900; text-transform: uppercase; border: none; font-size: 0.7rem; tracking-widest; cursor: pointer; }
        .nav-btn-prev { flex: 1; padding: 0.8rem; background: #f1f5f9; color: #64748b; border-radius: 0.8rem; font-weight: 900; text-transform: uppercase; border: none; font-size: 0.7rem; tracking-widest; cursor: pointer; }
        
        .live-edit-mode .exercise-item, .live-edit-mode .dialogue-row { outline: 1px dashed #6366f1 !important; outline-offset: 4px; position: relative; }
        .edit-solution-tag { position: absolute; top: -14px; left: 10px; font-size: 7px; font-weight: 900; color: #6366f1; background: white; padding: 0 4px; border-radius: 2px; border: 1px solid #e0e7ff; z-index: 10; pointer-events: none; }

        @keyframes popIn { 0% { opacity: 0; transform: translateY(-5px) scale(0.95); } 100% { opacity: 1; transform: translateY(0) scale(1); } }
        @keyframes bounceIn { 0% { opacity: 0; transform: scale(0.3); } 50% { opacity: 1; transform: scale(1.05); } 100% { transform: scale(1); } }
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="h-full">
    <div id="app-root">
        <header id="main-header" class="px-6 pt-6 bg-white border-b border-slate-50 pb-4">
            <h1 class="text-xl font-black text-slate-900 leading-tight">Pronomen: Demonstrativ-, Indefinit- und Possessivpronomen</h1>
            <div id="progress-container" class="w-full h-1 bg-slate-100 rounded-full mt-4 overflow-hidden hidden">
                <div id="bar" class="h-full bg-indigo-600 transition-all duration-500" style="width:0%"></div>
            </div>
        </header>
        <div id="scroll-container"><div id="container"></div></div>
        <nav id="nav-bar">
            <button id="prev" class="nav-btn-prev hidden">Zur√ºck</button>
            <button id="next" class="nav-btn-next">Weiter</button>
        </nav>
    </div>

    <script>
        const tasks = [{"id":"ex-8","title":"√úbung 8: der/die/das erg√§nzen","html":"<p class=\"mb-4\">Erg√§nzen Sie <em>der/die/das</em> im Nominativ, Akkusativ oder Dativ.</p><div class=\"exercise-item border-l-[6px] border-emerald-500 bg-white p-6 mb-4 rounded-r-2xl shadow-sm\"><p class=\"text-sm text-gray-500 italic mb-2\">... √ºber die neue Kollegin?</p><span class=\"item-number font-black text-slate-300 mr-2 text-sm italic\">1.</span> Ob <input type=\"text\" class=\"exercise-input\" data-solution=\"der\" data-tip=\"Dativ, Feminin (die Kollegin)\"> das Mofa im Hof geh√∂rt?</div><div class=\"exercise-item border-l-[6px] border-amber-400 bg-white p-6 mb-4 rounded-r-2xl shadow-sm\"><span class=\"item-number font-black text-slate-300 mr-2 text-sm italic\">2.</span> Mit <input type=\"text\" class=\"exercise-input\" data-solution=\"der\" data-tip=\"Dativ, Feminin (nach 'mit')\"> w√ºrde ich gern mal Kaffee trinken.</div><div class=\"exercise-item border-l-[6px] border-rose-400 bg-white p-6 mb-4 rounded-r-2xl shadow-sm\"><span class=\"item-number font-black text-slate-300 mr-2 text-sm italic\">3.</span> Ach, f√ºr <input type=\"text\" class=\"exercise-input\" data-solution=\"die\" data-tip=\"Akkusativ, Feminin (nach 'f√ºr')\"> sind die Blumen.</div><div class=\"exercise-item border-l-[6px] border-indigo-500 bg-white p-6 mb-4 rounded-r-2xl shadow-sm\"><p class=\"text-sm text-gray-500 italic mb-2\">... √ºber das neue Computerprogramm?</p><span class=\"item-number font-black text-slate-300 mr-2 text-sm italic\">4.</span> <input type=\"text\" class=\"exercise-input\" data-solution=\"Das\" data-tip=\"Nominativ, Neutrum\"> ist ja kompliziert.</div><div class=\"exercise-item border-l-[6px] border-emerald-500 bg-white p-6 mb-4 rounded-r-2xl shadow-sm\"><span class=\"item-number font-black text-slate-300 mr-2 text-sm italic\">5.</span> Mit <input type=\"text\" class=\"exercise-input\" data-solution=\"dem\" data-tip=\"Dativ, Neutrum (nach 'mit')\"> komme ich gar nicht zurecht.</div><div class=\"exercise-item border-l-[6px] border-amber-400 bg-white p-6 mb-4 rounded-r-2xl shadow-sm\"><span class=\"item-number font-black text-slate-300 mr-2 text-sm italic\">6.</span> Nichts Besonderes, <input type=\"text\" class=\"exercise-input\" data-solution=\"das\" data-tip=\"Akkusativ, Neutrum\"> kenne ich schon.</div><div class=\"exercise-item border-l-[6px] border-rose-400 bg-white p-6 mb-4 rounded-r-2xl shadow-sm\"><p class=\"text-sm text-gray-500 italic mb-2\">... √ºber den neuen Sch√ºler?</p><span class=\"item-number font-black text-slate-300 mr-2 text-sm italic\">7.</span> <input type=\"text\" class=\"exercise-input\" data-solution=\"Der\" data-tip=\"Nominativ, Maskulin\"> sieht so aus, als ob er alles kann.</div><div class=\"exercise-item border-l-[6px] border-indigo-500 bg-white p-6 mb-4 rounded-r-2xl shadow-sm\"><span class=\"item-number font-black text-slate-300 mr-2 text-sm italic\">8.</span> Neben <input type=\"text\" class=\"exercise-input\" data-solution=\"dem\" data-tip=\"Dativ, Maskulin (neben wem?)\"> m√∂chte ich gern sitzen.</div><div class=\"exercise-item border-l-[6px] border-emerald-500 bg-white p-6 mb-4 rounded-r-2xl shadow-sm\"><span class=\"item-number font-black text-slate-300 mr-2 text-sm italic\">9.</span> F√ºr <input type=\"text\" class=\"exercise-input\" data-solution=\"den\" data-tip=\"Akkusativ, Maskulin (nach 'f√ºr')\"> interessieren sich sicher einige M√§dchen.</div><div class=\"exercise-item border-l-[6px] border-amber-400 bg-white p-6 mb-4 rounded-r-2xl shadow-sm\"><p class=\"text-sm text-gray-500 italic mb-2\">... √ºber die neuen Nachbarn?</p><span class=\"item-number font-black text-slate-300 mr-2 text-sm italic\">10.</span> <input type=\"text\" class=\"exercise-input\" data-solution=\"Die\" data-tip=\"Nominativ, Plural\"> sehen ganz nett aus.</div><div class=\"exercise-item border-l-[6px] border-rose-400 bg-white p-6 mb-4 rounded-r-2xl shadow-sm\"><span class=\"item-number font-black text-slate-300 mr-2 text-sm italic\">11.</span> F√ºr <input type=\"text\" class=\"exercise-input\" data-solution=\"die\" data-tip=\"Akkusativ, Plural\"> gie√üe ich gern mal die Blumen.</div><div class=\"exercise-item border-l-[6px] border-indigo-500 bg-white p-6 mb-4 rounded-r-2xl shadow-sm\"><span class=\"item-number font-black text-slate-300 mr-2 text-sm italic\">12.</span> Mit <input type=\"text\" class=\"exercise-input\" data-solution=\"denen\" data-tip=\"Dativ, Plural (nach 'mit')\"> will ich nichts zu tun haben.</div>"},{"id":"ex-9","title":"√úbung 9: Passende Pronomen","html":"<p class=\"mb-4\">Erg√§nzen Sie die passenden Pronomen.</p><div class=\"exercise-item border-l-[6px] border-emerald-500 bg-white p-6 mb-4 rounded-r-2xl shadow-sm\"><span class=\"item-number font-black text-slate-300 mr-2 text-sm italic\">1.</span> F√ºr eines der H√§user m√ºssen wir uns entscheiden. Ich w√§re f√ºr <select class=\"exercise-select\" data-solution=\"das\" data-tip=\"Optionen: das, dem\"><option value=\"\">--</option><option value=\"das\">das</option><option value=\"dem\">dem</option></select> am Stadtrand. Bei <select class=\"exercise-select\" data-solution=\"dem\" data-tip=\"Optionen: das, dem\"><option value=\"\">--</option><option value=\"das\">das</option><option value=\"dem\">dem</option></select> anderen ist die Miete zu hoch.</div><div class=\"exercise-item border-l-[6px] border-amber-400 bg-white p-6 mb-4 rounded-r-2xl shadow-sm\"><span class=\"item-number font-black text-slate-300 mr-2 text-sm italic\">2.</span> Wie findest du die Schr√§nke hier? ‚Äì <select class=\"exercise-select\" data-solution=\"Der\" data-tip=\"Optionen: Der, Die\"><option value=\"\">--</option><option value=\"Der\">Der</option><option value=\"Die\">Die</option></select> dunkelbraune gef√§llt mir ganz gut, <select class=\"exercise-select\" data-solution=\"die\" data-tip=\"Optionen: der, die\"><option value=\"\">--</option><option value=\"der\">der</option><option value=\"die\">die</option></select> anderen sind mir zu modern.</div><div class=\"exercise-item border-l-[6px] border-rose-400 bg-white p-6 mb-4 rounded-r-2xl shadow-sm\"><span class=\"item-number font-black text-slate-300 mr-2 text-sm italic\">3.</span> Was h√§ltst du von den St√ºhlen? ‚Äì <select class=\"exercise-select\" data-solution=\"Die\" data-tip=\"Optionen: Die, Diese, Denen\"><option value=\"\">--</option><option value=\"Die\">Die</option><option value=\"Diese\">Diese</option><option value=\"Denen\">Denen</option></select> hier w√ºrden gut in unsere Wohnung passen. Aber auf <select class=\"exercise-select\" data-solution=\"denen\" data-tip=\"Optionen: die, diese, denen\"><option value=\"\">--</option><option value=\"die\">die</option><option value=\"diese\">diese</option><option value=\"denen\">denen</option></select> sitzt man nicht gut. Wir nehmen besser <select class=\"exercise-select\" data-solution=\"die\" data-tip=\"Optionen: die, diese, denen\"><option value=\"\">--</option><option value=\"die\">die</option><option value=\"diese\">diese</option><option value=\"denen\">denen</option></select> anderen.</div><div class=\"exercise-item border-l-[6px] border-indigo-500 bg-white p-6 mb-4 rounded-r-2xl shadow-sm\"><span class=\"item-number font-black text-slate-300 mr-2 text-sm italic\">4.</span> Welchen Tennisschl√§ger willst du denn jetzt kaufen? Ich w√ºrde <select class=\"exercise-select\" data-solution=\"den\" data-tip=\"Optionen: der, den, diesen\"><option value=\"\">--</option><option value=\"der\">der</option><option value=\"den\">den</option><option value=\"diesen\">diesen</option></select> aus China nehmen. <select class=\"exercise-select\" data-solution=\"Der\" data-tip=\"Optionen: Der, Den, Diesen\"><option value=\"\">--</option><option value=\"Der\">Der</option><option value=\"Den\">Den</option><option value=\"Diesen\">Diesen</option></select> ist doch nicht schlecht. Oder findest du <select class=\"exercise-select\" data-solution=\"diesen\" data-tip=\"Optionen: der, den, diesen\"><option value=\"\">--</option><option value=\"der\">der</option><option value=\"den\">den</option><option value=\"diesen\">diesen</option></select> hier besser?</div><div class=\"exercise-item border-l-[6px] border-emerald-500 bg-white p-6 mb-4 rounded-r-2xl shadow-sm\"><span class=\"item-number font-black text-slate-300 mr-2 text-sm italic\">5.</span> Von den leckeren Pralinen muss ich <select class=\"exercise-select\" data-solution=\"welche\" data-tip=\"Optionen: die, denen, welche\"><option value=\"\">--</option><option value=\"die\">die</option><option value=\"denen\">denen</option><option value=\"welche\">welche</option></select> mitnehmen. <select class=\"exercise-select\" data-solution=\"Die\" data-tip=\"Optionen: Die, Denen, Welche\"><option value=\"\">--</option><option value=\"Die\">Die</option><option value=\"Denen\">Denen</option><option value=\"Welche\">Welche</option></select> mit dunkler Schokolade mag ich am liebsten. Von <select class=\"exercise-select\" data-solution=\"denen\" data-tip=\"Optionen: die, denen, welche\"><option value=\"\">--</option><option value=\"die\">die</option><option value=\"denen\">denen</option><option value=\"welche\">welche</option></select> kann ich nicht genug kriegen.</div>"},{"id":"ex-10","title":"√úbung 10: Indefinitpronomen","html":"<p class=\"mb-4\">Erg√§nzen Sie das passende Pronomen (welche/s/n/r, eine/s/n/r, keine/s/n/r).</p><div class=\"exercise-item border-l-[6px] border-emerald-500 bg-white p-6 mb-4 rounded-r-2xl shadow-sm\"><span class=\"item-number font-black text-slate-300 mr-2 text-sm italic\">1.</span> Ich suche Blattsalat. ‚Äì Tut mir leid, wir haben <input type=\"text\" class=\"exercise-input\" data-solution=\"keinen\" data-tip=\"Akkusativ, Maskulin\"> mehr.</div><div class=\"exercise-item border-l-[6px] border-amber-400 bg-white p-6 mb-4 rounded-r-2xl shadow-sm\"><span class=\"item-number font-black text-slate-300 mr-2 text-sm italic\">2.</span> Gibt es irgendwo noch kleine Kartoffeln? ‚Äì Nein, leider <input type=\"text\" class=\"exercise-input\" data-solution=\"keine\" data-tip=\"Akkusativ, Plural\"> mehr.</div><div class=\"exercise-item border-l-[6px] border-rose-400 bg-white p-6 mb-4 rounded-r-2xl shadow-sm\"><span class=\"item-number font-black text-slate-300 mr-2 text-sm italic\">3.</span> Wo sind Ihre Kr√§uter? ‚Äì Da im Regal stehen <input type=\"text\" class=\"exercise-input\" data-solution=\"welche\" data-tip=\"Plural (Indefinit)\"> im Glas.</div><div class=\"exercise-item border-l-[6px] border-indigo-500 bg-white p-6 mb-4 rounded-r-2xl shadow-sm\"><span class=\"item-number font-black text-slate-300 mr-2 text-sm italic\">4.</span> Haben Sie noch deutschen Spargel? ‚Äì Leider nein, nur noch <input type=\"text\" class=\"exercise-input\" data-solution=\"welchen\" data-tip=\"Akkusativ, Maskulin (Indefinit)\"> aus Griechenland.</div><div class=\"exercise-item border-l-[6px] border-emerald-500 bg-white p-6 mb-4 rounded-r-2xl shadow-sm\"><span class=\"item-number font-black text-slate-300 mr-2 text-sm italic\">5.</span> Ich br√§uchte frisches Basilikum. ‚Äì Ich bringe Ihnen gleich <input type=\"text\" class=\"exercise-input\" data-solution=\"welches\" data-tip=\"Akkusativ, Neutrum (Indefinit)\">.</div><div class=\"exercise-item border-l-[6px] border-amber-400 bg-white p-6 mb-4 rounded-r-2xl shadow-sm\"><span class=\"item-number font-black text-slate-300 mr-2 text-sm italic\">6.</span> Ich h√§tte gern eine gro√üe Wassermelone. Drau√üen in der Kiste m√ºsste noch <input type=\"text\" class=\"exercise-input\" data-solution=\"eine\" data-tip=\"Nominativ, Feminin\"> sein.</div>"},{"id":"ex-11","title":"√úbung 11: Possessivpronomen","html":"<p class=\"mb-4\">Erg√§nzen Sie das Possessivpronomen mit der richtigen Endung.</p><div class=\"exercise-item border-l-[6px] border-emerald-500 bg-white p-6 mb-4 rounded-r-2xl shadow-sm\"><span class=\"item-number font-black text-slate-300 mr-2 text-sm italic\">1.</span> Das schwarze T-Shirt geh√∂rt Ulrike. Ist das braune auch <input type=\"text\" class=\"exercise-input\" data-solution=\"deins\" data-tip=\"Besitzer: du, Objekt: Neutrum\">?</div><div class=\"exercise-item border-l-[6px] border-amber-400 bg-white p-6 mb-4 rounded-r-2xl shadow-sm\"><span class=\"item-number font-black text-slate-300 mr-2 text-sm italic\">2.</span> Hier ist noch ein wei√ües Hemd. Ist das <input type=\"text\" class=\"exercise-input\" data-solution=\"deins\" data-tip=\"Besitzer: du, Objekt: Neutrum\">, Andr√©? ‚Äì Nein, an <input type=\"text\" class=\"exercise-input\" data-solution=\"meinem\" data-tip=\"Besitzer: ich, Objekt: Neutrum (Dativ)\"> fehlen keine Kn√∂pfe.</div><div class=\"exercise-item border-l-[6px] border-rose-400 bg-white p-6 mb-4 rounded-r-2xl shadow-sm\"><span class=\"item-number font-black text-slate-300 mr-2 text-sm italic\">3.</span> Ist das nicht die Tischdecke von deinen Eltern? Ich glaube, das ist <input type=\"text\" class=\"exercise-input\" data-solution=\"ihre\" data-tip=\"Besitzer: Eltern (sie Pl.), Objekt: Feminin\">. Wir haben noch nie eine rote besessen.</div><div class=\"exercise-item border-l-[6px] border-indigo-500 bg-white p-6 mb-4 rounded-r-2xl shadow-sm\"><span class=\"item-number font-black text-slate-300 mr-2 text-sm italic\">4.</span> Der Pullover ist aber eingegangen. ‚Äì Das war <input type=\"text\" class=\"exercise-input\" data-solution=\"meiner\" data-tip=\"Besitzer: ich, Objekt: Maskulin\">! Der h√§tte mit der Hand gewaschen werden m√ºssen.</div><div class=\"exercise-item border-l-[6px] border-emerald-500 bg-white p-6 mb-4 rounded-r-2xl shadow-sm\"><span class=\"item-number font-black text-slate-300 mr-2 text-sm italic\">5.</span> Die Hose hat doch Mark getragen. Das ist bestimmt <input type=\"text\" class=\"exercise-input\" data-solution=\"seine\" data-tip=\"Besitzer: Mark (er), Objekt: Feminin\">.</div><div class=\"exercise-item border-l-[6px] border-amber-400 bg-white p-6 mb-4 rounded-r-2xl shadow-sm\"><span class=\"item-number font-black text-slate-300 mr-2 text-sm italic\">6.</span> Die bunte Bettw√§sche kenne ich. Ilka und Adrian, das kann nur <input type=\"text\" class=\"exercise-input\" data-solution=\"eure\" data-tip=\"Besitzer: ihr, Objekt: Feminin\"> sein. ‚Äì Nein stimmt nicht! Wir haben <input type=\"text\" class=\"exercise-input\" data-solution=\"unsere\" data-tip=\"Besitzer: wir, Objekt: Feminin\"> schon selbst gewaschen. Das ist Sebastians. Ich bin ganz sicher, das ist <input type=\"text\" class=\"exercise-input\" data-solution=\"seine\" data-tip=\"Besitzer: Sebastian (er), Objekt: Feminin\">.</div>"}];
        const settings = {"showCheckButton":true,"showProgressBar":true,"instantFeedback":true,"showTips":true};
        let cur = 0;
        let isEditMode = false;
        let taskResults = {}; 

        const cont = document.getElementById('container');
        const scrollCont = document.getElementById('scroll-container');
        const nBtn = document.getElementById('next');
        const pBtn = document.getElementById('prev');
        const bar = document.getElementById('bar');
        const header = document.getElementById('main-header');
        const prog = document.getElementById('progress-container');

        if(settings.showProgressBar) prog.classList.remove('hidden');

        window.addEventListener('message', (e) => {
            if (e.data.type === 'TOGGLE_EDIT_MODE') {
                isEditMode = e.data.enabled;
                document.body.classList.toggle('live-edit-mode', isEditMode);
                render(cur);
            }
        });

        function render(idx) {
            if (idx >= tasks.length) {
                header.classList.add('hidden');
                document.getElementById('nav-bar').classList.add('hidden');
                let totalCorrect = 0, totalPossible = 0, rowsHtml = '';
                tasks.forEach((t, i) => {
                    const res = taskResults[i] || { correct: 0, total: 0 };
                    totalCorrect += res.correct; totalPossible += res.total;
                    rowsHtml += `
                        <div class="flex justify-between items-center py-3 border-bottom border-slate-100">
                            <span class="text-[10px] font-black uppercase text-slate-400">${t.title}</span>
                            <span class="text-sm font-black">${res.correct} / ${res.total}</span>
                        </div>`;
                });
                const percentage = totalPossible > 0 ? Math.round((totalCorrect / totalPossible) * 100) : 0;
                cont.innerHTML = `<div class="animate-fade-in py-4 text-center">
                    <div class="text-6xl mb-4">üèÜ</div>
                    <h2 class="text-3xl font-black text-slate-900">Auswertung</h2>
                    <p class="text-slate-500 font-bold mb-8">Du hast ${percentage}% erreicht.</p>
                    <div class="bg-white border border-slate-100 rounded-2xl p-6 shadow-sm mb-8">${rowsHtml}</div>
                    <button id="restart" class="check-btn !mt-0 !bg-indigo-600">Neu starten</button>
                </div>`;
                document.getElementById('restart').onclick = () => location.reload();
                if(percentage >= 80) confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
                return;
            }

            cont.innerHTML = `<div class="page animate-fade-in"><div class="mb-6"><span class="text-[9px] font-black text-indigo-600 uppercase tracking-widest block mb-1">Aufgabe ${idx+1} von ${tasks.length}</span><h2 class="task-title text-slate-900 text-xl font-black leading-tight">${tasks[idx].title}</h2></div><div id="body-wrapper" class="relative">${tasks[idx].html}</div><div id="fb" class="hidden mt-6"></div>${settings.showCheckButton && !isEditMode ? '<button id="check" class="check-btn">Pr√ºfen</button>' : ''}</div>`;
            
            const bodyWrapper = document.getElementById('body-wrapper');
            const mainTitle = header.querySelector('h1');
            const taskTitle = document.querySelector('.task-title');

            if (settings.showTips && !isEditMode) {
                bodyWrapper.querySelectorAll('[data-tip]').forEach(el => {
                    const tipText = el.getAttribute('data-tip');
                    if (tipText && tipText !== "null" && tipText.trim() !== "") {
                        const btn = document.createElement('button');
                        btn.className = 'tip-btn';
                        btn.innerHTML = 'üí°';
                        const content = document.createElement('div');
                        content.className = 'tip-content';
                        content.innerText = tipText;
                        btn.onclick = (e) => { e.stopPropagation(); content.classList.toggle('visible'); };
                        el.after(btn);
                        btn.after(content);
                    }
                });
            }

            if(isEditMode) {
                mainTitle.contentEditable = "true"; taskTitle.contentEditable = "true";
                bodyWrapper.querySelectorAll('p, span:not(.word-option):not(.item-number), h1, h2, .exercise-item, div').forEach(el => {
                    if (el.children.length === 0 || el.classList.contains('exercise-item') || el.classList.contains('dialogue-row')) {
                        el.contentEditable = "true";
                    }
                });
                bodyWrapper.querySelectorAll('.exercise-select, .exercise-input').forEach(el => {
                   el.value = el.dataset.solution || '';
                   const tag = document.createElement('span'); tag.className = 'edit-solution-tag'; tag.innerText = 'L√ñSUNG' + (el.dataset.tip ? ' + TIPP' : ''); el.parentNode.insertBefore(tag, el);
                });
            } else {
                if(settings.showCheckButton) {
                    document.getElementById('check').onclick = () => {
                        document.querySelectorAll('.solution-hint').forEach(h => h.remove());
                        let pts = 0, total = 0;
                        document.querySelectorAll('.exercise-select').forEach(sel => {
                            total++; const ok = sel.value === sel.dataset.solution;
                            sel.classList.add(ok ? 'correct' : 'incorrect'); if(ok) pts++; else { const h = document.createElement('span'); h.className = 'solution-hint'; h.innerText = sel.dataset.solution; sel.after(h); }
                        });
                        document.querySelectorAll('.exercise-input').forEach(i => {
                            total++; const val = i.value.trim().toLowerCase(); const sols = (i.dataset.solution || '').toLowerCase().split('/').map(s => s.trim());
                            const ok = sols.includes(val); i.classList.add(ok ? 'correct' : 'incorrect');
                            if(ok) pts++; else { const h = document.createElement('span'); h.className = 'solution-hint'; h.innerText = i.dataset.solution; i.after(h); }
                        });
                        document.querySelectorAll('.word-option').forEach(opt => {
                            const isSol = opt.dataset.solution === 'true', isSel = opt.classList.contains('selected');
                            if(isSol) total++; if(isSel && isSol) { opt.classList.add('correct-selection'); pts++; } else if(isSel && !isSol) { opt.classList.add('incorrect-selection'); pts = Math.max(0, pts - 0.5); }
                        });
                        taskResults[idx] = { correct: Math.floor(pts), total: total };
                        const fb = document.getElementById('fb'); fb.classList.remove('hidden');
                        fb.innerHTML = `<div class="p-4 bg-indigo-50 border border-indigo-100 rounded-2xl text-center font-black text-indigo-600 text-xs uppercase">${Math.floor(pts)} von ${total} Punkten erreicht</div>`;
                    };
                }
                document.querySelectorAll('.word-option').forEach(opt => opt.onclick = () => opt.classList.toggle('selected'));
            }

            pBtn.classList.toggle('hidden', idx === 0);
            nBtn.innerText = idx === tasks.length - 1 ? 'Auswertung' : 'Weiter';
            bar.style.width = ((idx + 1) / tasks.length * 100) + '%';
        }
        nBtn.onclick = () => render(++cur);
        pBtn.onclick = () => render(--cur);
        render(0);
    </script>
</body>
</html>